{% extends molecule('wishlist-detail-table', '@SprykerShop:WishlistPage') %}

{% define config = {
    name: 'wishlist-detail-table',
} %}

{% macro image(imageUrl, name, className, modifiers = []) %}
	{% if imageUrl %}
		{% include molecule('lazy-image') with {
            modifiers: modifiers,
            class: className,
            data: {
                imageSrc: imageUrl,
                imageTitle: name,
            },
        } only %}
	{% endif %}
{% endmacro %}

{% block actionContent %}
	<input type="hidden" name="id-wishlist-item" value="{{ idWishlistItem }}">

	{% if widgetGlobalExists('MerchantProductOfferWidget') %}
		{% include molecule('wishlist-item-product-offer', 'MerchantProductOfferWidget') with {
            data: {
                productView: item,
            },
        } only %}
	{% elseif widgetGlobalExists('MerchantProductWidget') %}
		{% include molecule('wishlist-item-merchant-product', 'MerchantProductWidget') with {
            data: {
                productView: item,
            },
        } only %}
	{% endif %}
{% endblock %}

{% block wishlistMoveToCartAction %}
	{% if wishlistMoveToCartForm %}
		{{ form_start(wishlistMoveToCartForm, { action: moveToCartActionPath, name: moveToCartFormName, attr: { id: moveToCartFormName } }) }}
		<button class="button add-to-cart-button">
			{{ 'customer.account.wishlist.add-to-cart' | trans }}
		</button>

		{{ block('actionContent') }}
		{{ form_end(wishlistMoveToCartForm) }}
	{% endif %}
{% endblock %}

{% block wishlistRemoveItemAction %}
	{% if wishlistRemoveItemForm %}
		{{ form_start(wishlistRemoveItemForm, { action: removeItemActionPatch, name: removeItemFormName, attr: { id: removeItemFormName } }) }}
		<button class="remove-btn"><i class="fa-solid fa-heart"></i></button>
		{{ block('actionContent') }}
		{{ form_end(wishlistRemoveItemForm) }}
	{% endif %}
{% endblock %}

{% block body %}
	<div class="wishlist">
		<div class="wishlist__grid">
			{% for idWishlistItem, item in data.wishlistItems %}
				{% set isItemAvailable = item.available is defined and item.available and item.price is defined and item.price is not null %}
				{% set productDiscontinuedWidget = findWidget('ProductDiscontinuedWidget', [item.sku]) %}
				{% set isDiscontinued = productDiscontinuedWidget.isDiscontinued %}
				{% if isDiscontinued is not null %}
					{% set isItemAvailable = not isDiscontinued and isItemAvailable %}
				{% endif %}
				{% set imageUrl = item.images.0.externalUrlSmall ?? '' %}
				{% import _self as macros %}

				<article class="wishlist-card" aria-labelledby="product-{{ loop.index }}">
                    {% set moveToCartFormName = 'addToCart_' ~ loop.index %}
					{% set moveToCartActionPath = path('wishlist/move-to-cart', { sku: item.sku, 'wishlist-name': data.wishlistName }) %}
					{% set wishlistMoveToCartForm = data.wishlistMoveToCartFormClone.getForm.createView ?? null %}
					{% set removeItemFormName = 'deleteWishlistItem_' ~ loop.index %}
					{% set removeItemActionPatch = path('wishlist/remove-item', { sku: item.sku, 'wishlist-name': data.wishlistName }) %}
					{% set wishlistRemoveItemForm = data.wishlistRemoveItemFormClone.getForm.createView ?? null %}
					{# heart / favourite - top right #}
					<div class="upper-section">
						{% if item.idProductAbstract %}
							{% block productAbstractLabels %}
								{# <div class=""> #}
								{% widget 'ProductAbstractLabelWidget' args [item.idProductAbstract] with {
                                    data: {
                                        parentJsName: config.jsName,
                                    },
                                } only %}{% endwidget %}
								{# </div> #}
							{% endblock %}
						{% endif %}
						{{ block('wishlistRemoveItemAction') }}

					</div>
					{# 1. Title / Name #}
						<h3 id="product-{{ loop.index }}" class="wishlist-card__name"> <a href="{{ item.url }}" class="wishlist-card__link">{{ item.name }}</a>
					</h3>

					{# 2. Rating row #}
					{% if item.rating %}
						<div class="wishlist-card__rating" title="{{ item.rating }} out of 5">
							<span class="wishlist-card__stars" aria-hidden="true">
								{% for i in 1..5 %}
									<i class="star{% if i <= item.rating|round(0,'floor') %} is--filled{% endif %}">â˜…</i>
								{% endfor %}
							</span>
							<span class="wishlist-card__rating-value">{{ item.rating }}</span>
							<span class="wishlist-card__reviews">({{ item.reviews }})</span>
						</div>
					{% endif %}

					{# 3. Image (centered) #}
					<a href="{{ item.url }}" class="wishlist-card__image">
						{{ _self.image(imageUrl, item.name, '', ['thumbnail', 'spaceless']) }}
					</a>

					{# 4. Price block #}
					<div class="wishlist-card__price">
						{% if item.price is not null %}
							{% include molecule('money-price') with {
                                modifiers: ['wishlist'],
                                data: {
                                    amount: item.price,
                                    originalAmount: item.prices.ORIGINAL ?? null,
                                },
                            } only %}
						{% else %}
							N/A
						{% endif %}

						<div class="wishlist-card__tax">Incl. Shipping &amp; all Taxes</div>
					</div>
					{% set moveToCartFormName = 'addToCart_' ~ loop.index %}
					{% set moveToCartActionPath = path('wishlist/move-to-cart', { sku: item.sku, 'wishlist-name': data.wishlistName }) %}
					{% set wishlistMoveToCartForm = data.wishlistMoveToCartFormClone.getForm.createView ?? null %}
					{% set removeItemFormName = 'deleteWishlistItem_' ~ loop.index %}
					{% set removeItemActionPatch = path('wishlist/remove-item', { sku: item.sku, 'wishlist-name': data.wishlistName }) %}
					{% set wishlistRemoveItemForm = data.wishlistRemoveItemFormClone.getForm.createView ?? null %}
					{# 5. CTA and small meta #}
					<div class="wishlist-card__button">
						{{ block('wishlistMoveToCartAction') }}
					</div>

					<div class="wishlist-card__controls">
						<label class="wishlist-card__compare">
							<input type="checkbox" name="compare"/>
							Compare
						</label>
					</div>
					<div id="wishlist-meta" class="wishlist-card__meta">
						<div class="wishlist-card__item-added">Item Added:
						</div>
						<div class="wishlist-card__part">Part Number:
						</div>
					</div>
				</article>
				{% widget 'WishlistProductAlternativeWidget' args [item, data.wishlistName] only %}{% endwidget %}
			{% endfor %}

		</div>
	</div>

{% endblock %}
